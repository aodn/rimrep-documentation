# Vulnerability Scanning and Resolution

## 1.Introduction
A vulnerability scanning is a systematic review of security weaknesses in an information system. It evaluates if the system is susceptible to any known vulnerabilities, assigns severity levels to those vulnerabilities, and recommends remediation or mitigation, if and whenever needed.

## 2.Vulnerability Scanning
- Purpose: Identify security weaknesses before they can be exploited by attackers.
- Types of Scans: External (from outside the network) and internal (within the network).
- Tools: Various tools like Nessus, OpenVAS, Qualys, and more are used for scanning.

## 3.Vulnerability Identification
Categorize vulnerabilities based on severity levels (e.g., low, medium, high).
- Detailed List of Vulnerabilities Found
- Severity Levels (e.g., Low, Medium, High)
- Categorization by Systems/Assets

## 4.Risk Assessment
Determine potential impacts and likelihood of exploitation for each vulnerability.
- Impact Analysis of Vulnerabilities
- Potential Threats Exploiting Identified Vulnerabilities
- Risk Mitigation Strategies

## 5.Resolution Plan
- Prioritization of Vulnerabilities
- Assigning Responsible Parties
- Timeline for Resolving Vulnerabilities

### Selecting a Vulnerability Scanner
- Choose a suitable security scanning tool that integrates well with GitHub Actions. Some popular options include:
- Snyk: For scanning dependencies and container images.
- Trivy: For scanning container images for vulnerabilities.
- CodeQL: For static analysis of code to find security vulnerabilities.

### Setting up GitHub Actions Workflow
- Create a .github/workflows directory in your repository.
- Inside this directory, create a YAML file (e.g., security-scan.yml) to define your GitHub Actions workflow.

### Defining the Workflow
- Define workflow triggers (e.g., on push, pull request, scheduled).
- Configure the steps required for vulnerability scanning:
    - Checkout repository.
    - Install necessary dependencies or tools for the scanner.
    - Execute the scanner with appropriate configurations.
    - Capture and display scan results or reports.

### Integration with the Vulnerability Scanner
- Configure the workflow to use the selected vulnerability scanner's API or CLI.
- Provide necessary authentication tokens or credentials securely as GitHub Secrets.
- Define scanning parameters and targets (e.g., codebase, dependencies, container images).

### Interpreting Scan Results
- Process and interpret the results generated by the scanner within the workflow.
- Set thresholds or rules to determine the severity levels of vulnerabilities.
- Decide on the actions to be taken based on the identified vulnerabilities (e.g., fail the workflow, generate reports).

### Remediation and Mitigation
- Automate actions within the workflow to address vulnerabilities:
- For dependencies: Update dependencies to patched versions.
- For code issues: Implement fixes and push code changes if possible.
- For container images: Rebuild images with patched components and third party software versions.

### Docker image scanning with Trivy vulnerability scanner
```yaml
name: Run Trivy vulnerability scanner in docker mode
      uses: aquasecurity/trivy-action@master
      with:
          image-ref: ${{ steps.build-image.outputs.image }}
          format: 'table'
          severity: 'HIGH,CRITICAL'
          vuln-type: 'os,library'
          exit-code: 1
          ignore-unfixed: true
      continue-on-error: true
```
- "continue-on-error: true" if set to true will continue deployment workflow if vulnerabilities are detected while scanning.
- "continue-on-error: false" if set to false will stop the deployment workflow until vulnerabilities are remediated fixed and re-scanned.

### Below sample shows Trivy Vulnerability scan results
- Run Trivy vulnerability scanner in docker mode

![vulnerability scan results](images/vul-scan-result.png)

- Severity type: Critical/High/Low
- From the result list select the link(Ex:- https://avd.aquasec.com/nvd/cve-2023-30861) which will show the remediation and fix
- The report also shows installed thrid party versions on the docker image which might have vulnerability and a proper fixed versions for the same.
- From vulnerability column copy the code (Ex:- CVE-2023-30861 or CVE-2023-25577) searh for possible fix and remediation

### Workflow YAML (Using Sonar Cloud for Scanning):
Here's a simplified example of a GitHub Actions workflow using Sonar Cloud for scanning:
```yaml
name: Dependency Vulnerability Scan
on:
  push:
    branches:
      - main
jobs:
  sonarcloud:
    name: SonarCloud
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Shallow clones should be disabled for a better relevancy of analysis
      - name: SonarCloud Scan
        uses: SonarSource/sonarcloud-github-action@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # secrets.GITHUB_TOKEN
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }} # secrets.SONAR_TOKEN
```

- SONAR_TOKEN – Required this is the token used to authenticate access to SonarCloud. You can generate a token on your Security page in SonarCloud (https://sonarcloud.io/account/security/). You can set the SONAR_TOKEN environment variable in the "Secrets" settings page of your repository.
- GITHUB_TOKEN – Provided by Github (see Authenticating with the GITHUB_TOKEN - https://help.github.com/en/actions/automating-your-workflow-with-github-actions/authenticating-with-the-github_token).

### Falco runtime error alerts
- Falco is an open-source runtime security platform that allows you to detect and respond to suspicious behavior within Linux containers and applications.
- It detects unexpected application behavior and alerts on threats at runtime.
- It also provide runtime security monitoring for other container orchestration platforms and standalone container deployments.
- Falco Alerts: If a monitored event does not match up with what is expected from the defined rules, then an alert is triggered. Alerts can be sent via email or Slack notifications, or they can be sent to another third-party service (such as PagerDuty or Datadog) for further analysis or investigation.

- Falco config

```yaml
falcosidekick:
enabled: false
  webui:
    enabled: false
  config:
    slack:
      webhookurl: https://hooks.slack.com/services/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
auditLog:
  enabled: false
falco:
  jsonOutput: false
  fileOutput:
    enabled: false
```

## Note:
- Falco runtime alerts, can be enabled by changing the falcosidekick.enabled to true.
- Falco rules can be found at https://github.com/falcosecurity/rules
- Falco Alerts Channel name is : #falco-alerts

- Slack alert

![falco slack alert notification](images/falco-slack-alert.png)
